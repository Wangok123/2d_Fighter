# 双端通用工具库

> 一个用.NET Standard 2.1所写的双端通用工具库，可同时在客户端和服务器端使用

## 简介

PublicLib是2D Fighter项目的公共工具库，采用.NET Standard 2.1标准编写，确保代码可以在Unity客户端和.NET服务器端共享使用。这种设计保证了客户端和服务器使用相同的逻辑，特别是在需要确定性计算的场景下（如战斗系统）。

## 设计原则

- **平台无关**：不依赖Unity或特定平台API
- **确定性**：保证相同输入得到相同输出
- **高性能**：优化的算法和数据结构
- **零GC**：尽可能避免内存分配

## 模块列表

### 1. [计时器系统（Timer）](./Timer/概述.md)

提供多种计时器实现，用于游戏中的定时任务和延迟执行。

**子模块**：
- [AsyncTimer](./Timer/AsyncTimer.md) - 异步计时器
- [FrameTimer](./Timer/FrameTimer.md) - 帧计时器
- [TickTimer](./Timer/TickTimer.md) - Tick计时器

**使用场景**：
- 技能冷却时间
- Buff持续时间
- 延迟执行
- 周期性任务

### 2. [定点数（FixedNum）](./FixedNum/概述.md)

提供确定性的定点数运算，避免浮点数误差。

**核心功能**：
- 定点数基本运算（加减乘除）
- 三角函数
- 向量运算
- 碰撞检测

**使用场景**：
- 战斗伤害计算
- 位置同步
- 物理模拟
- 任何需要确定性的数值计算

## 使用方法

### 引用库

在项目中引用PublicLib：

```csharp
// Unity客户端
using PublicLib.Timer;
using PublicLib.FixedNum;

// 服务器端
using PublicLib.Timer;
using PublicLib.FixedNum;
```

### 示例代码

#### 使用计时器

```csharp
// 创建一个3秒的倒计时
var timer = new TickTimer(3000);

// 每帧更新
timer.Update(deltaTime);

// 检查是否完成
if (timer.IsFinished)
{
    Debug.Log("Timer finished!");
}
```

#### 使用定点数

```csharp
// 创建定点数
FixedNum a = new FixedNum(10);
FixedNum b = new FixedNum(3);

// 运算
FixedNum result = a / b;

// 转换为浮点数（仅用于显示）
float displayValue = result.ToFloat();
```

## 扩展开发

如需添加新的公共模块：

1. 在PublicLib目录创建新模块
2. 使用.NET Standard 2.1标准
3. 避免使用平台特定API
4. 编写单元测试
5. 更新本文档

## 技术规范

- **C#版本**：C# 9.0
- **.NET标准**：.NET Standard 2.1
- **编码规范**：遵循项目代码规范
- **单元测试**：每个模块都应有测试

## 注意事项

- ⚠️ 不要在PublicLib中引用Unity API
- ⚠️ 不要使用异步/等待（async/await），除非在特定模块中
- ⚠️ 避免使用LINQ，可能影响性能和确定性
- ⚠️ 所有浮点数计算应使用FixedNum

## 相关文档

- [项目总览](../01-项目总览.md)
- [技术栈](../02-技术栈.md)
- [客户端架构](../03-客户端架构.md)
- [服务端架构](../04-服务端架构.md)