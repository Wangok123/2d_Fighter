# 定时器

## 定时系统面临的技术问题：
 
- Unity客户端：
  - 使用协程定时依赖于`Monobehaviour`，物体激活属性变化会**中断调用**；
  - 使用Update()帧循环计算计时非常不便，多层的定时需要设置大量**标志变量**，让代码臃肿，结构极不稳定；
  - 删除定时任务非常麻烦；
- 服务器：
  - 高性能服务器一般使用了多线程技术，需要`支持多线程`；
  - 为了提高运行效率，逻辑线程还需要使用局部的定时器；

## LATTimer
 
- 类型：TickTimer、AsyncTimer、FrameTimer
- 使用便捷，通过API直接调用传参即可；
- 不依赖Unity引擎环境，可在客户端服务器使用；
- 可设置`嵌套任务`、`循环任务`，也可`取消任务`；

## Timer基类

这个代码定义了一个抽象类 `Timer`，它位于命名空间 `LATTimer` 中。该类包含了一些回调函数和抽象方法，用于管理定时任务。

首先，`Timer` 类定义了三个回调函数：
```csharp
public Action<string> LogCallback;
public Action<string> WarningCallback;
public Action<string> ErrorCallback;
```
这些回调函数分别用于日志记录、警告和错误处理。

接下来，`Timer` 类定义了几个抽象方法：
```csharp
public abstract int AddTask(uint delay, Action<int> endCallback, Action<int> cancelCallback, int count = 1);
public abstract bool DeleteTask(int taskId);
public abstract void Reset();
public abstract int GenerateTid();
```
- `AddTask` 方法用于增加一个定时任务。它接受延迟时间（毫秒）、任务结束时的回调、任务取消时的回调以及重复计数次数（默认为1）作为参数，并返回一个任务ID。
- `DeleteTask` 方法用于删除一个定时任务，接受任务ID作为参数，并返回一个布尔值表示是否成功删除。
- `Reset` 方法用于重置计时器。
- `GenerateTid` 方法用于生成一个新的任务ID。

此外，`Timer` 类还包含一个受保护的字段 `Tid`，用于存储当前任务ID：
```csharp
protected int Tid;
```

这个抽象类提供了一个框架，具体的定时器实现类需要继承这个类并实现这些抽象方法。

## 类型

- [时间定时](./TickTimer.md)
- [多线程定时](./AsyncTimer.md)
- [帧定时](./FrameTimer.md)